---
layout: page
title:  "트위치 챗봇 만들기"
date:   2020-07-16
categories: [트위치API]
tags: [트위치API, 프로젝트]
---
이번 글에서는 트위치가 제공하는 개발자를 위한 서비스를 살펴봅니다.

이 글은 그 중에서도 트위치의 채팅 시스템을 관리하는 방법을 알아봅니다.



## 트위치 IRC란?

---

트위치는 Internet Relay Chat이란 인터페이스를 통해 채팅에 관한 기능을 제공합니다.

챗봇은 트위치 채팅 서버와 연결하기위해 동작하는 봇입니다.

챗봇은 트위치 채팅 서버 네트워크와 직접 클라이언트로써 연결되는 코드라고 이해하시면 될 거 같습니다.

이 챗봇에 관한 코드를 조작함으로써 우리가 직접 시청자가 보낸 메세지를 불러오고 그에 대한 알고리즘을 만들 수 있습니다. 



![chatbot1](https://user-images.githubusercontent.com/60007241/87639282-f9909e80-c77f-11ea-9cb4-702318bf7ef9.png)



이 사진과 같이 직접 시청자의 채팅에 반응하게 만들 수 있습니다.

## 개발환경 조성

---

직접 트위치 챗봇을 로컬 컴퓨터에서 실행시켜 보기위해서 node.js를 설치하겠습니다.

저는 리눅스 우분투 18.04 환경에서 node.js를 설치했습니다.



[https://nodejs.org/ko/](https://nodejs.org/ko/)



node.js 홈페이지에서 LTS라고 써있는 버전을 다운받고 설치하면 됩니다.

LTS는 장기간 동안 안정적인 서비스를 제공하는 버전이라는 뜻 입니다.

설치가 완료 되었는지 확인하기 위해 다음과 같은 명령어를 통해 버전이 잘 나오는지 확인해봅시다.

> node -v

node.js를 설치하면 패키지 매니저인 npm도 같이 설치됩니다.

npm도 마찬가지로 버전 체크를 해줍시다.

> npm -v



![nodejs2](https://user-images.githubusercontent.com/60007241/87639287-fac1cb80-c77f-11ea-9813-84549666f519.png)



설치가 잘 되었으면 위와 같이 출력됩니다.

그 후 트위치 채팅을 관리하기 위한 패키지인 tmi.js도 설치해줍니다.

> npm install tmp.js



트위치 아이디도 필요하기 때문에 회원가입 해줍시다.



[https://www.twitch.tv/](https://www.twitch.tv/)



## 트위치 챗봇 만들기

---

트위치에서 제공하는 기본 bot.js를 보면서 어떻게 작동하는지 알아봅시다.

```javascript
const tmi = require('tmi.js');

// Define configuration options
const opts = {
  identity: {
    username: <BOT_USERNAME>,
    password: <OAUTH_TOKEN>
  },
  channels: [
    <CHANNEL_NAME>
  ]
};
// Create a client with our options
const client = new tmi.client(opts);

// Register our event handlers (defined below)
client.on('message', onMessageHandler);
client.on('connected', onConnectedHandler);

// Connect to Twitch:
client.connect();

// Called every time a message comes in
function onMessageHandler (target, context, msg, self) {
  if (self) { return; } // Ignore messages from the bot

  // Remove whitespace from chat message
  const commandName = msg.trim();

  // If the command is known, let's execute it
  if (commandName === '!dice') {
    const num = rollDice();
    client.say(target, `You rolled a ${num}`);
    console.log(`* Executed ${commandName} command`);
  } else {
    console.log(`* Unknown command ${commandName}`);
  }
}
// Function called when the "dice" command is issued
function rollDice () {
  const sides = 6;
  return Math.floor(Math.random() * sides) + 1;
}
// Called every time the bot connects to Twitch chat
function onConnectedHandler (addr, port) {
  console.log(`* Connected to ${addr}:${port}`);
}
```



\<BOT_USERNAME\>은 봇을 실행하기위한 계정아이디입니다.

\<OAUTH_TOKEN\>은 트위치 서버에 접근하기위한 비밀번호라고 보시면 됩니다.

이 비밀번호를 할당받기 위해서 트위치에서는 토큰을 할당받는 홈페이지를 따로 제공해줍니다.

봇의 아이디로 트위치에 로그인한 상태로 다음 홈페이지에서 토큰을 할당받으면 됩니다.



[https://twitchapps.com/tmi/](https://twitchapps.com/tmi/) 



\<CHANNEL_NAME\>은 챗봇이 실행되기 원하는 채널명을 적으면 됩니다.

트위치를 시청할 때 URL뒤에 붙는 것이 채널 이름입니다.

> twitch.tv/<CHANNEL_NAME>



이제 `node bot.js  `명령어를 통해 자바스크립트 파일을 실행시킵시다.

콘솔에서 현재 파일 경로의 bot.js란 파일을 실행시키는 명령어입니다.

그 후 해당 트위치 채널로 들어가서 채팅창에 `!dice`라는 명령어를 치면 메세지 핸들러가 직접 채팅서버에 주사위를 굴린 결과를 출력하는 것을 확인할 수 있습니다.





![result1](https://user-images.githubusercontent.com/60007241/87639518-568c5480-c780-11ea-8ee3-a04339f6fdaf.png)





![result2](https://user-images.githubusercontent.com/60007241/87639524-57bd8180-c780-11ea-9a23-5316a1c387e9.png)

다음과 같이 `!dice`명령어가 잘 실행되면 성공입니다.

위 사진에서는 봇 계정과 채팅을 치는 계정이 동일하기 때문에 모두 똑같은 아이디가 출력 된 것 입니다.